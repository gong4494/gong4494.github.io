<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Candy Cane Snake!</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family:'Nunito',sans-serif;
      background: #0d0820;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:hidden;
      position:relative;
    }

    /* Falling snowflakes */
    .snowflake {
      position:fixed;
      top:-20px;
      color:white;
      font-size:1em;
      pointer-events:none;
      animation: snowfall linear infinite;
      opacity:0.7;
    }
    @keyframes snowfall {
      0%   { transform:translateY(0) rotate(0deg);    opacity:0.7; }
      100% { transform:translateY(105vh) rotate(360deg); opacity:0; }
    }

    h1 {
      font-size:clamp(1.6rem,4vw,2.4rem);
      font-weight:900;
      color:#FFE066;
      text-shadow:2px 2px 0 #c9a800, 0 0 30px rgba(255,100,100,0.5);
      margin-bottom:14px;
      letter-spacing:1px;
      text-align:center;
    }

    .hud {
      display:flex;
      gap:20px;
      margin-bottom:14px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .hud-pill {
      background:rgba(255,255,255,0.12);
      border:2px solid rgba(255,255,255,0.2);
      border-radius:30px;
      padding:8px 22px;
      font-size:1rem;
      font-weight:800;
      color:white;
      backdrop-filter:blur(4px);
    }
    .hud-pill span { color:#FFE066; }

    #canvas-wrap {
      position:relative;
    }

    canvas {
      display:block;
      border-radius:16px;
      border:3px solid rgba(255,255,255,0.15);
      box-shadow:0 0 40px rgba(220,20,60,0.35), 0 0 80px rgba(220,20,60,0.1);
    }

    /* Overlays on canvas */
    .overlay {
      position:absolute;
      inset:0;
      border-radius:14px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:24px;
      background:rgba(13,8,32,0.85);
      backdrop-filter:blur(3px);
    }
    .overlay.hidden { display:none; }

    .overlay-emoji { font-size:3.5rem; margin-bottom:10px; }
    .overlay-title {
      font-size:clamp(1.6rem,4vw,2.4rem);
      font-weight:900; color:#FFE066;
      text-shadow:2px 2px 0 #c9a800;
      margin-bottom:8px;
    }
    .overlay-sub {
      font-size:1rem; color:rgba(255,255,255,0.75);
      margin-bottom:6px; line-height:1.5;
    }
    .overlay-score {
      font-size:1.4rem; font-weight:900;
      color:#DC143C; margin:10px 0 20px;
    }
    .overlay-btn {
      padding:14px 36px;
      background:#DC143C; color:white;
      border:none; border-radius:50px;
      font-family:'Nunito',sans-serif;
      font-size:1.1rem; font-weight:800;
      cursor:pointer;
      box-shadow:0 5px 0 #8a000a, 0 8px 20px rgba(220,20,60,0.4);
      transition:transform 0.1s, box-shadow 0.1s;
      margin:4px;
    }
    .overlay-btn:active { transform:translateY(4px); box-shadow:0 1px 0 #8a000a; }
    .overlay-btn.ghost {
      background:transparent;
      border:2px solid rgba(255,255,255,0.4);
      color:rgba(255,255,255,0.8);
      box-shadow:none;
    }

    .controls-hint {
      margin-top:14px;
      font-size:0.82rem;
      color:rgba(255,255,255,0.4);
      text-align:center;
    }

    /* D-pad for mobile */
    .dpad {
      display:none;
      margin-top:16px;
      flex-direction:column;
      align-items:center;
      gap:4px;
    }
    .dpad-row { display:flex; gap:4px; }
    .dpad-btn {
      width:52px; height:52px;
      background:rgba(255,255,255,0.12);
      border:2px solid rgba(255,255,255,0.2);
      border-radius:10px;
      color:white; font-size:1.4rem;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition:background 0.1s;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .dpad-btn:active { background:rgba(220,20,60,0.6); }

    @media (max-width:560px) or (pointer:coarse) {
      .dpad { display:flex; }
    }
    @media (pointer:coarse) { .dpad { display:flex; } }
  </style>
</head>
<body>

  <h1>ğŸ¬ Candy Cane Snake ğŸ¬</h1>

  <div class="hud">
    <div class="hud-pill">Score: <span id="score-val">0</span></div>
    <div class="hud-pill">Best: <span id="hi-val">0</span></div>
    <div class="hud-pill" id="speed-pill">Speed: <span id="speed-val">1</span></div>
  </div>

  <div id="canvas-wrap">
    <canvas id="game"></canvas>

    <!-- Start screen -->
    <div class="overlay" id="start-screen">
      <div class="overlay-emoji">ğŸ¬</div>
      <div class="overlay-title">Candy Cane Snake!</div>
      <div class="overlay-sub">Eat the sweets to grow your candy cane!<br/>Don't hit the walls or yourself!</div>
      <div style="margin-top:14px;">
        <button class="overlay-btn" onclick="startGame()">â–¶ Play!</button>
      </div>
      <div class="overlay-sub" style="margin-top:16px; font-size:0.85rem;">
        Arrow Keys / WASD to move &nbsp;â€¢&nbsp; P to pause
      </div>
    </div>

    <!-- Pause screen -->
    <div class="overlay hidden" id="pause-screen">
      <div class="overlay-emoji">â¸</div>
      <div class="overlay-title">Paused</div>
      <button class="overlay-btn" onclick="togglePause()">â–¶ Resume</button>
    </div>

    <!-- Game over screen -->
    <div class="overlay hidden" id="gameover-screen">
      <div class="overlay-emoji">ğŸ’”</div>
      <div class="overlay-title">Oh no!</div>
      <div class="overlay-sub">Your candy cane snapped!</div>
      <div class="overlay-score" id="final-score"></div>
      <button class="overlay-btn" onclick="startGame()">ğŸ”„ Try Again</button>
    </div>
  </div>

  <!-- D-pad -->
  <div class="dpad">
    <div class="dpad-row">
      <button class="dpad-btn" ontouchstart="dpadPress('up')"   onclick="dpadPress('up')">â–²</button>
    </div>
    <div class="dpad-row">
      <button class="dpad-btn" ontouchstart="dpadPress('left')" onclick="dpadPress('left')">â—€</button>
      <button class="dpad-btn" ontouchstart="dpadPress('down')" onclick="dpadPress('down')">â–¼</button>
      <button class="dpad-btn" ontouchstart="dpadPress('right')"onclick="dpadPress('right')">â–¶</button>
    </div>
  </div>

  <div class="controls-hint">Arrow Keys / WASD Â· P = Pause</div>

  <script>
    // â”€â”€ Canvas setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const canvas = document.getElementById('game');
    const ctx    = canvas.getContext('2d');

    const CELL   = 20;
    const COLS   = 25;
    const ROWS   = 25;
    canvas.width  = COLS * CELL;
    canvas.height = ROWS * CELL;

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let snake, dir, nextDir, food, score, hiScore = 0;
    let state = 'start';   // start | playing | paused | gameover
    let loopId, frameId;
    let tickMs = 150;
    let foodAnim = 0;       // for pulsing food

    // Candy types for food
    const CANDIES = [
      { color:'#FF4466', glow:'#FF0033', label:'ğŸ¬' },
      { color:'#FFD700', glow:'#FFA500', label:'â­' },
      { color:'#FF69B4', glow:'#FF1493', label:'ğŸ­' },
      { color:'#7CFC00', glow:'#00AA00', label:'ğŸŒŸ' },
      { color:'#00BFFF', glow:'#007FBF', label:'ğŸ’' },
      { color:'#FF8C00', glow:'#CC5500', label:'ğŸŠ' },
    ];
    let currentCandy = CANDIES[0];

    // â”€â”€ Init game â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function startGame() {
      snake    = [{x:12, y:12},{x:11,y:12},{x:10,y:12}];
      dir      = {x:1, y:0};
      nextDir  = {x:1, y:0};
      score    = 0;
      tickMs   = 150;
      state    = 'playing';
      showOverlay(null);
      document.getElementById('score-val').textContent = '0';
      document.getElementById('speed-val').textContent = '1';
      placeFood();
      clearInterval(loopId);
      loopId = setInterval(tick, tickMs);
      cancelAnimationFrame(frameId);
      renderLoop();
    }

    function placeFood() {
      do {
        food = {x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS)};
      } while (snake.some(s => s.x===food.x && s.y===food.y));
      currentCandy = CANDIES[Math.floor(Math.random()*CANDIES.length)];
    }

    // â”€â”€ Game tick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function tick() {
      if (state !== 'playing') return;
      dir = nextDir;

      const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

      // Wall collision
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
        return doGameOver();
      }
      // Self collision
      if (snake.some(s => s.x===head.x && s.y===head.y)) {
        return doGameOver();
      }

      snake.unshift(head);

      if (head.x===food.x && head.y===food.y) {
        score++;
        if (score > hiScore) hiScore = score;
        document.getElementById('score-val').textContent = score;
        document.getElementById('hi-val').textContent    = hiScore;
        placeFood();
        // Speed up every 5 points
        if (score % 5 === 0) {
          clearInterval(loopId);
          tickMs = Math.max(65, 150 - Math.floor(score/5)*12);
          loopId = setInterval(tick, tickMs);
          const lvl = Math.floor(score/5)+1;
          document.getElementById('speed-val').textContent = lvl;
        }
      } else {
        snake.pop();
      }
    }

    function doGameOver() {
      state = 'gameover';
      clearInterval(loopId);
      document.getElementById('final-score').textContent =
        `Score: ${score}${score > 0 && score === hiScore ? '  ğŸ† New Best!' : ''}`;
      showOverlay('gameover-screen');
    }

    function togglePause() {
      if (state === 'playing') {
        state = 'paused';
        clearInterval(loopId);
        showOverlay('pause-screen');
      } else if (state === 'paused') {
        state = 'playing';
        showOverlay(null);
        loopId = setInterval(tick, tickMs);
      }
    }

    function showOverlay(id) {
      ['start-screen','pause-screen','gameover-screen'].forEach(s => {
        document.getElementById(s).classList.toggle('hidden', s !== id);
      });
    }

    // â”€â”€ Render loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderLoop() {
      foodAnim += 0.05;
      draw();
      frameId = requestAnimationFrame(renderLoop);
    }

    // â”€â”€ Drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function draw() {
      // Background â€” dark festive
      ctx.fillStyle = '#0d0820';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // Subtle grid
      ctx.strokeStyle = 'rgba(255,255,255,0.035)';
      ctx.lineWidth = 0.5;
      for (let x=0; x<=COLS; x++) {
        ctx.beginPath(); ctx.moveTo(x*CELL,0); ctx.lineTo(x*CELL,canvas.height); ctx.stroke();
      }
      for (let y=0; y<=ROWS; y++) {
        ctx.beginPath(); ctx.moveTo(0,y*CELL); ctx.lineTo(canvas.width,y*CELL); ctx.stroke();
      }

      drawFood();
      if (snake && snake.length > 0) drawSnake();
    }

    // â”€â”€ Food â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function drawFood() {
      const pulse = 0.85 + Math.sin(foodAnim * 2.5) * 0.15;
      const cx = food.x * CELL + CELL/2;
      const cy = food.y * CELL + CELL/2;
      const r  = (CELL/2 - 2) * pulse;

      ctx.save();
      ctx.shadowColor = currentCandy.glow;
      ctx.shadowBlur  = 14 + Math.sin(foodAnim*2)*4;
      ctx.fillStyle   = currentCandy.color;
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI*2);
      ctx.fill();
      ctx.shadowBlur = 0;

      // Shine
      ctx.fillStyle = 'rgba(255,255,255,0.45)';
      ctx.beginPath();
      ctx.arc(cx - r*0.28, cy - r*0.28, r*0.32, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    // â”€â”€ Snake (candy cane) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function roundRect(x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y);
      ctx.arcTo(x+w, y,   x+w, y+r,   r);
      ctx.lineTo(x+w, y+h-r);
      ctx.arcTo(x+w, y+h, x+w-r, y+h, r);
      ctx.lineTo(x+r, y+h);
      ctx.arcTo(x,   y+h, x,   y+h-r, r);
      ctx.lineTo(x,   y+r);
      ctx.arcTo(x,   y,   x+r, y,     r);
      ctx.closePath();
    }

    function drawSegment(sx, sy, isHead, segIndex) {
      const pad  = 2;
      const x    = sx * CELL + pad;
      const y    = sy * CELL + pad;
      const size = CELL - pad * 2;
      const r    = isHead ? 7 : 5;

      // Candy cane: alternate red & white
      const isRed = segIndex % 2 === 0;
      const bg    = isRed ? '#DC143C' : '#FFFFFF';
      const stripe= isRed ? 'rgba(255,255,255,0.45)' : 'rgba(220,20,60,0.55)';
      const border= isRed ? '#9b0020' : '#cccccc';

      ctx.save();
      if (isHead) {
        ctx.shadowColor = '#DC143C';
        ctx.shadowBlur  = 10;
      }

      // Fill segment
      ctx.fillStyle = bg;
      roundRect(x, y, size, size, r);
      ctx.fill();

      // Clip for stripe
      ctx.save();
      roundRect(x, y, size, size, r);
      ctx.clip();

      // Diagonal stripe (slash pattern)
      ctx.fillStyle = stripe;
      const sw = size * 0.28;
      const offset = isHead ? size*0.45 : size*0.42;
      ctx.fillRect(x + offset - sw*0.5, y - 2, sw, size + 4);

      ctx.restore(); // remove clip

      // Border
      ctx.strokeStyle = border;
      ctx.lineWidth = 1;
      roundRect(x, y, size, size, r);
      ctx.stroke();

      ctx.restore();
    }

    function drawSnake() {
      // Draw tail â†’ head (so head renders on top)
      for (let i = snake.length-1; i >= 0; i--) {
        drawSegment(snake[i].x, snake[i].y, i===0, i);
      }

      // Draw eyes on head
      drawEyes();
    }

    function drawEyes() {
      const head  = snake[0];
      const cx    = head.x * CELL + CELL/2;
      const cy    = head.y * CELL + CELL/2;
      const er    = 2.5;
      const dist  = 4;

      // Perpendicular to direction
      const px = -dir.y, py = dir.x;

      const e1x = cx + px*dist + dir.x*2;
      const e1y = cy + py*dist + dir.y*2;
      const e2x = cx - px*dist + dir.x*2;
      const e2y = cy - py*dist + dir.y*2;

      ctx.fillStyle = 'white';
      ctx.beginPath(); ctx.arc(e1x, e1y, er, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(e2x, e2y, er, 0, Math.PI*2); ctx.fill();

      ctx.fillStyle = '#111';
      ctx.beginPath(); ctx.arc(e1x + dir.x*0.8, e1y + dir.y*0.8, er*0.55, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(e2x + dir.x*0.8, e2y + dir.y*0.8, er*0.55, 0, Math.PI*2); ctx.fill();
    }

    // â”€â”€ D-Pad â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function dpadPress(d) {
      if (state === 'start' || state === 'gameover') { startGame(); return; }
      if (state === 'paused') { togglePause(); return; }
      const map = {
        up:    {x:0,  y:-1},
        down:  {x:0,  y:1},
        left:  {x:-1, y:0},
        right: {x:1,  y:0},
      };
      const nd = map[d];
      if (nd.x !== -dir.x || nd.y !== -dir.y) nextDir = nd;
    }

    // â”€â”€ Keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('keydown', e => {
      if (state === 'start' || state === 'gameover') {
        if ([' ','Enter','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d'].includes(e.key)) {
          startGame(); return;
        }
      }
      if (e.key === 'p' || e.key === 'P' || e.key === 'Escape') {
        if (state === 'playing' || state === 'paused') togglePause();
        return;
      }
      const map = {
        ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},
        ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},
        w:{x:0,y:-1},s:{x:0,y:1},a:{x:-1,y:0},d:{x:1,y:0},
        W:{x:0,y:-1},S:{x:0,y:1},A:{x:-1,y:0},D:{x:1,y:0},
      };
      if (map[e.key]) {
        e.preventDefault();
        const nd = map[e.key];
        if (nd.x !== -dir.x || nd.y !== -dir.y) nextDir = nd;
      }
    });

    // â”€â”€ Touch swipe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let touchStart = null;
    canvas.addEventListener('touchstart', e => {
      touchStart = {x: e.touches[0].clientX, y: e.touches[0].clientY};
      e.preventDefault();
    }, {passive:false});
    canvas.addEventListener('touchend', e => {
      if (!touchStart) return;
      const dx = e.changedTouches[0].clientX - touchStart.x;
      const dy = e.changedTouches[0].clientY - touchStart.y;
      if (Math.abs(dx) < 10 && Math.abs(dy) < 10) return;
      if (Math.abs(dx) > Math.abs(dy)) {
        dpadPress(dx > 0 ? 'right' : 'left');
      } else {
        dpadPress(dy > 0 ? 'down' : 'up');
      }
      touchStart = null;
    }, {passive:false});

    // â”€â”€ Snowflakes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const FLAKES = ['â„','â…','â†','Â·','*'];
    for (let i=0; i<22; i++) {
      const el = document.createElement('span');
      el.className = 'snowflake';
      el.textContent = FLAKES[Math.floor(Math.random()*FLAKES.length)];
      el.style.left = Math.random()*100+'vw';
      el.style.fontSize = (0.6+Math.random()*1.2)+'rem';
      el.style.animationDuration = (5+Math.random()*10)+'s';
      el.style.animationDelay    = (Math.random()*10)+'s';
      el.style.opacity = 0.3 + Math.random()*0.5;
      document.body.appendChild(el);
    }

    // â”€â”€ Initial draw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Draw a preview snake on the start screen
    snake   = [];
    dir     = {x:1,y:0};
    nextDir = {x:1,y:0};
    food    = {x:18, y:12};
    currentCandy = CANDIES[0];
    // Build a spiral-ish preview snake
    for (let i=0; i<10; i++) snake.push({x:12-i, y:12});
    renderLoop();
  </script>
</body>
</html>
